<html>
  <head>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js">
    </script>
    <link rel="stylesheet"
          href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
    <link rel="stylesheet"
          href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js">
    </script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js">
    </script>
    <script src="/js/ox.ajast.js"></script>
    <script src="/js/webtoolkit.md5.js"></script>
    <script src="/js/KalturaClientBase.js"></script>
    <script src="/js/KalturaTypes.js"></script>
    <script src="/js/KalturaVO.js"></script>
    <script src="/js/KalturaServices.js"></script>
    <script src="/js/KalturaClient.js"></script>
    <script src="/js/vendor/jquery.ui.widget.js"></script>
    <script src="/js/jquery.fileupload.js"></script>
    <script src="/js/jquery.fileupload-kaltura.js"></script>

    <script>
      var config = new KalturaConfiguration(1760921);
      config.serviceUrl = "http://www.kaltura.com/";
      var client = new KalturaClient(config);
      client.session.start(function(success, ks) {
        client.setKs(ks);
      }, "8d6cb692ab0f41bfa6bde373204c4b40",
      null,
      KalturaSessionType.ADMIN,
      1760921)
    </script>
    <script type="text/javascript">
      var addFromUploadedFileBaseEntry = function(request, callback) {
        entry = new KalturaBaseEntry();
        entry.name = request.name;
        var uploadTokenId = request.uploadTokenId;
        var type = null;

        var getResults = function() {
          if (!client.ks) return setTimeout(getResults, 100);
          client.baseEntry.addFromUploadedFile(function(success, results) {
            if (!success || (results.code && results.message)) {
              console.log('Kaltura Error', success, results);
            } else {
              console.log('Kaltura Result', results);
              callback(results)
            }
          },
          entry,
          uploadTokenId,
          type);
        }
        getResults();
      };
    </script>
  </head>
  <body>
    <script id="UploadForm-template" type="text/x-underscore-template" style="display: none">
      <script type="text/javascript">
        var setupUpload = function() {
          if (!client.ks) return setTimeout(setupUpload, 100);
          file = $('input[name="fileData"]').fileupload({
            apiURL:'http://www.kaltura.com/api_v3/',
            url: 'http://www.kaltura.com/api_v3/?service=uploadToken&action=upload&format=1',
            ks: client.ks,
            singleFileUploads: true,
            dataType: 'json',
            autoUpload: true,
            submit: function(e, data) {
              $('#Uploading').show();
            },
            done: function(e, data) {
              $('#Uploading').hide();
              $('#UploadDone').html(UploadDone({result: data.result}));
            },
          });
        };
        $(document).ready(setupUpload);
      <% print("</"+"script>"); %>

      <h1>Upload Video</h1>
      <label>Video to Upload</label>
      <input type="file" name="fileData"></input>
      <div id="Uploading" style="display: none">
        <div class="alert alert-info">
          Uploading Â 
          <i class="fa fa-spin fa-refresh"></i>
        </div>
      </div>
      <div id="UploadDone"></div>
    </script>
    <script type="text/javascript">
      var UploadForm = _.template($('#UploadForm-template').text());
    </script>

    <script id="UploadDone-template" type="text/x-underscore-template" style="display: none">
      <p>Uploaded file <%= result.fileName %>. Creating entry...</p>
      <div id="addFromUploadedFileBaseEntry-result"></div>
      <%
          addFromUploadedFileBaseEntry({
             name: result.fileName,
             uploadTokenId: result.id,
          }, function(result) {
            $('#addFromUploadedFileBaseEntry-result').replaceWith(CreatedEntry({result: result}))
          })
      %>
    </script>
    <script type="text/javascript">
      var UploadDone = _.template($('#UploadDone-template').text());
    </script>

    <script id="CreatedEntry-template" type="text/x-underscore-template" style="display: none">
      <p>Created entry <%= result.name %></p>
    </script>
    <script type="text/javascript">
      var CreatedEntry = _.template($('#CreatedEntry-template').text());
    </script>

    <div class="container" style="margin-top:40px">
    </div>
    <script type="text/javascript">
      $('.container').html(UploadForm())
    </script>
  </body>
</html>